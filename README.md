# CVAE-RRT: A Hybrid Motion Planning Framework

This repository implements a novel approach for motion planning using **Conditional Variational Autoencoders (CVAEs)** integrated into the **RRT* algorithm** to improve sampling efficiency. It includes tools for data collection, model training, testing, and visualization.

## Table of Contents
1. [Overview](#overview)
2. [Features](#features)
3. [Directory Structure](#directory-structure)
4. [Dependencies](#dependencies)
5. [Usage](#usage)
    - [1. Data Collection](#1-data-collection)
    - [2. Model Training](#2-model-training)
    - [3. Model Testing](#3-model-testing)
6. [Results and Visualizations](#results-and-visualizations)
7. [Future Work](#future-work)

---

## Overview

Traditional motion planning algorithms like **RRT** and **RRT*** suffer from inefficiencies in sampling unpromising regions, especially in complex environments. This repository integrates **CVAEs** to generate biased sampling distributions conditioned on the environment and task constraints, significantly reducing planning time and improving path quality.

---

## Features

- **Data Collection**: Generate and collect diverse motion planning scenarios across different environments.
- **Model Training**: Train a CVAE to bias the sampling process in motion planning.
- **Model Testing**: Evaluate the hybrid CVAE-RRT* method in various 2D environments.
- **Visualization**: Visualize the growth of the RRT tree, sample distributions, and resulting paths.


---

## Dependencies

requirements.txt is present in the repository to install the necessary packages. Run the following command to install the dependencies:

```bash
pip install -r requirements.txt
```


---

## Usage

### 1. Data Collection

Generate training data by collecting planning scenarios using the `data_collection.py` script. This involves running **RRT* planners** in various 2D environments.

#### Example Command:
```bash
python data_collection.py ../../motion_planning_datasets/ data_collection data_collection_pickle 5 1000 10 "(0,100)" "(0,100)" "(1,1)" "(99,99)" --env shifting_gaps forest
```

#### Parameters:
- `map_folder`: Directory containing environment maps.
- `data_collection_folder`: Directory to store collected data.
- `data_collection_pickle_folder`: Directory to save data in pickle format.
- `extend_len`: Step size for RRT* expansion.
- `time_horizon`: Maximum iterations for data collection.
- `start` and `goal`: Start and goal positions in the map.
- `--env`: List of environment names.

---

### 2. Model Training

Train the **CVAE model** on the collected data using `learned_solver.py`. This script prepares the dataset, initializes the model, and trains it over several epochs.

#### Example Command:
```bash
python learned_solver.py --train True --env_name forest
```
or 
```bash
python learned_solver.py --train True --env_name shifting_gaps
```

#### Parameters:
- `--env_name`: Name of the environment for training (e.g., `forest`).
- `--train`: Flag to train the model.
- Training data must be stored in the appropriate directory.

---

### 3. Model Testing

Evaluate the trained **CVAE-RRT*** model on test environments. The testing script visualizes the RRT tree, the learned sampling distribution, and the final path.

#### Example Command:
```bash
python learned_solver.py --test True --model_location forest_epoch_570-0.01331585762090981.pt --num_test_samples 5
```

The above .pt is given as exmaple. You can use the model you trained as well.

#### Parameters:
- `--test`: Flag to test the model.
- `--model_location`: Path to the trained model checkpoint.
- `--num_test_samples`: Number of test cases to evaluate.

---

## Results and Visualizations

The repository includes visualizations showing:
1. **RRT Tree Growth**: Iterative tree generation toward the goal.
2. **Density Heatmap**: Learned sample distribution generated by the CVAE.
3. **Final Path**: Optimized path discovered by the hybrid planner.

Generated visualizations and videos are saved in the `test_results/` directory.